<div class="container">
  <div class="card-profile">
    <div class="profile">
      <div class="profile-image">
        <img
          [src]="pokemon().picture"
          [alt]="pokemon().name"
          [title]="pokemon().name"
        />
      </div>
      <form [formGroup]="form" class="profile-info" (ngSubmit)="onSubmit()">
        <h2>{{ pokemon().name }}</h2>
        <div class="input-container">
          <label for="pokemon-name">Nom :</label>
          <input
            formControlName="name"
            id="pokemon-name"
            type="text"
            [value]="pokemon().name"
            placeholder="Nom du Pokémon"
            [class.isInvalid]="pokemonName.invalid"
          />
          <!-- invalid-feedback -->
          @if(pokemonName.hasError('required')){
          <div class="invalid-feedback">Veuillez renseigner ce champ</div>
          } @if(pokemonName.hasError('minlength')){
          <div class="invalid-feedback">
            Veuillez saisir un nom plus long (Minimum:
            {{ pokemonName.getError("minlength").requiredLength }})
          </div>
          } @if(pokemonName.hasError('maxlength')){
          <div class="invalid-feedback">
            Veuillez saisir un nom plus court (Maximum:
            {{ pokemonName.getError("maxlength").requiredLength }})
          </div>
          } @if(pokemonName.hasError('pattern')){
          <div class="invalid-feedback">
            Veuillez saisir un nom correct (Pattern: que des lettres min. et
            maj.)
          </div>
          }
        </div>
        <div class="input-container">
          <label>Points de vie :</label>
          <button
            class="btn btn-outline-secondary"
            [disabled]="pokemonLife.value <= POKEMON_RULES.MIN_LIFE"
            type="button"
            (click)="decrementLife()"
          >
            -
          </button>
          <input
            formControlName="life"
            type="number"
            [value]="pokemon().life"
            title="Points de vie"
            placeholder="Points de vie"
            [class.isInvalid]="pokemonLife.invalid"
          />
          <button
            class="btn btn-outline-secondary"
            [disabled]="pokemonLife.value >= POKEMON_RULES.MAX_LIFE"
            type="button"
            (click)="incrementLife()"
          >
            +
          </button>
        </div>
        <div class="input-container">
          <label>Dégâts :</label>
          <button
            class="btn btn-outline-secondary"
            [disabled]="pokemonDamage.value <= POKEMON_RULES.MIN_LIFE"
            type="button"
            (click)="decrementDamage()"
          >
            -
          </button>
          <input
            formControlName="damage"
            type="number"
            [value]="pokemon().damage"
            title="Dégâts"
            placeholder="Dégâts"
          />
          <button
            class="btn btn-outline-secondary"
            [disabled]="pokemonDamage.value >= POKEMON_RULES.MAX_LIFE"
            type="button"
            (click)="incrementDamage()"
          >
            +
          </button>
        </div>
        <div class="checkbox-container">
          <div id="container-pills">
            <label>Types :</label>
            <div>
              @for(type of pokemonTypeList.controls; track type; let index =
              $index){
              <button
                type="button"
                (click)="pokemonTypeList.removeAt(index)"
                [style.backgroundColor]="typesColor()[type.value].bg"
                [style.color]="typesColor()[type.value].text"
              >
                {{ type.value }}
                <span>X</span>
              </button>
              }
            </div>

            @if (pokemonTypeList.hasError('required')) {
            <p class="invalid-feedback">
              Veuillez sélectionner au moins un type de pokemon
            </p>
            }@if(pokemonTypeList.hasError('maxlength')){
            <p class="invalid-feedback">
              Veuillez sélectionner au maximum
              {{ pokemonTypeList.getError("maxlength").requiredLength }} types
              pour un pokemon
            </p>
            }
            <div id="container-checkboxes">
              @for(type of pokemonService.getPokemonTypeList(); track type) {
              <label>
                <input
                  #checkbox
                  (change)="onPokemonTypeChange(type, $event)"
                  [checked]="isPokemonTypeSelected(type)"
                  formArrayName="types"
                  type="checkbox"
                  [value]="type"
                  [id]="type"
                  (change)="('toggleType(type)')"
                />
                {{ type }}
              </label>
              }
            </div>
          </div>
        </div>
        <div class="button-group">
          <button type="button" [routerLink]="['/pokemons', pokemon().id]">
            Retour
          </button>
          <button
            type="submit"
            class="submit-form"
            [disabled]="form.invalid"
            [class.text-warning]="form.valid"
            [class.text-secondary]="form.invalid"
          >
            Sauvegarder les changements
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
